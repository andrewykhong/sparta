<HTML>
<CENTER><A HREF = "https://sparta.github.io">SPARTA WWW Site</A> - <A HREF = "Manual.html">SPARTA Documentation</A> - <A HREF = "Section_commands.html#comm">SPARTA Commands</A> 
</CENTER>






<HR>

<H3>custom command 
</H3>
<P><B>Syntax:</B>
</P>
<PRE>custom style action args ... action args ... 
</PRE>
<UL><LI>style = <I>particle</I> or <I>grid</I> or <I>surf</I> 

<LI>action = <I>create</I> or <I>remove</I> or <I>set</I> or <I>file</I> 

<PRE>  <I>create</I> args = cname datatype Nc
    cname = name of custom vector or array to create and initialize with zeroes
    datatype = <I>int</I> or <I>float</I> = for integer or floating point values
    Nc = 0 for a vector (single value), Nc >= 1 for an array (one or more values)
  <I>remove</I> arg2 = cname
    cname = name of custom vector or array to remove
  <I>set</I> args = cname v_name subset-ID region-ID
    cname = specify as name (no brackets) for custom vector with name
            or as name[N] for Nth column of custom array with name
    v_name = equal-, particle-, grid-, or surf-style variable with name
    subset-ID = mixture ID (particles) or group ID (grid cells or surf elements)
    region-ID = only apply to particle/grid/surf in region, NULL to not test
  <I>file</I> args = fname M cname1 cname2 ... cnameM
    fname = name of file with custom attributes for grid cells or surf elements
    M = # of custom values listed on each line of the file
    cname1,cname2,...,cnameM = which attribute each line's values are assigned to
      cnameI = name of a custom vector
      cnameI = name[N] for Nth column of a custom array with name
  <I>file/coarse</I> args = Nfile filestyle fname M cname1 cname2 ... cnameM
    Nfile = number of coarse files
    filestyle = <I>text</I> or <I>binary</I>
    fname = name of file with custom attributes for coarse grid cells
    M = # of custom values listed for each coarse cell entry in the file
    cname1,cname2,...,cnameM = which attribute each coarse cell's values are assigned to
      cnameI = name of a custom vector
      cnameI = name[N] for Nth column of a custom array with name 
</PRE>

</UL>
<P><B>Examples:</B>
</P>
<PRE>variable ivec particle id/100000
variable sdvec surf c_1*10+3.5
variable sdarray1 surf s_dvec+1
variable sdarray2 surf v_sdarray1+1 
</PRE>
<PRE>custom particle create ivec int 0 set ivec v_ivec air NULL
custom surf create sdvec float 0 set sdvec v_sdvec all NULL
custom surf create darray float 2 set darray[1] v_sdarray1 all NULL
custom surf set darray[2] v_sdarray2 all NULL
custom grid create gvec int 0 create garray float 2 file grid.attributes gvec garray<B>1</B> garray<B>2</B>
custom particle remove ivec
custom surf remove darray 
</PRE>
<P><B>Description:</B>
</P>
<P>Create or remove or initialize/reset custom attributes for particles,
grid cells, or surface elements.
</P>
<P>To create a new attribute, the <I>create</I> action is specified.  To
remove an attribute, the <I>remove</I> action is specified.  The <I>set</I>
action evaluates a variable to reset the values for an attribute.  The
<I>file</I> action reads a file with lines starting with a grid cell ID or
surface element ID followed by values for one or more per-grid or
per-surf attributes.  Particle-style attributes cannot be reset with
the <I>file</I> action.
</P>
<P>Custom attributes can be vectors (single value per entity) or arrays
(mutiple values per entity).  They can also be integer or floating
point values.  See <A HREF = "Section_howto.html#howto_17">Section 6.17</A> for an
explanation of custom attributes.
</P>
<P>The <I>style</I> setting is <I>particle</I> or <I>grid</I> or <I>surf</I> for custom
per-particle, per-grid, or per-surf attributes.
</P>
<P>The <I>action</I> setting is <I>create</I> or <I>remove</I> or <I>set</I> or <I>file</I> or
<I>file/coarse</I>.
</P>
<P>The <I>create</I> action creates a new custom attribute called <I>cname</I> and
initializes all its values to zero.  The <I>datatype</I> is specified as
<I>int</I> or <I>float</I> and determines what kind of values the attribute
stores.  <I>Nc</I> is specified as 0 for custom vector which stores a
single value per entity.  Specify <I>Nc</I> >= 1 for a custom array which
stores Nc values per entity.
</P>
<P>The <I>remove</I> action deletes the custom attribute called <I>cname</I>,
whether it is a vector or array.
</P>
<P>The <I>set</I> and <I>file</I> and <I>file/coarse</I> actions reset the values of
custom attribute(s) which must already exist.
</P>
<HR>

<P>The <I>set</I> action resets the values of a custom attribute by evaluating
a variable.  To operate on a custom vector, <I>cname</I> is simply the name
of the vector.  To operate on a single column of a custom array,
<I>cname</I> is specified as name[N] for the Nth column of a custom array
with name.
</P>
<P>The specified <I>v_name</I> is the name of the variable which is evaluated.
It must be either an equal-style or particle-style or grid-style or
surf-style variable.  All of these define a mathematical formula which
is used to compute the value(s) of the variable.  See the
<A HREF = "variable.html">variable</A> command for details.
</P>
<P>If an equal-style variable is specified, it produces a single value
which will be assigned as the custom value to all the particles or
grid cells or surface elements (see subset-ID and region-ID discussion
below).  Otherwise a particle-style variable must be used for <I>style
particle</I>, a grid-style variable for <I>style grid</I>, or a surf-style
variable for <I>style surf</I>.  When it is evaluated it generates one
value for each particle, grid cell, or surface element, which is
assigned to the custom vector or to a column of the custom array.
</P>
<P>Note that the latter 3 variable styles can include outputs from
<A HREF = "compute.html">compute</A> or <A HREF = "fix.html">fix</A> commands.  They can also
include the current timestep (as can equal-style variables) or the
spatial position of a particle, grid cell, or surface element in their
formula.  So it is easy to calculate a value for each entity which
varies in time or spatially.
</P>
<P>The next two arguments, <I>subset-ID</I> and <I>region-ID</I>, can limit which
particles, grid cells, or surface elements are assigned a custom
value.  An individual particle, grid cell, or surface element must
meet both criteria to have its custom value set, otherwise its value
is unchanged.
</P>
<P>The <I>subset-ID</I> is the ID of a mixture for particles or the ID of a
group of grid cells or surface elements.  Only particles in the
mixture or grid cells/surface elements in the group will be assigned a
value.  See the <A HREF = "mixture.html">mixture</A> and <A HREF = "group.html">group</A> commands
for more details.  Note that "all" is a pre-defined mixture ID which
contains all particles.  Likewise "all" is the name of a pre-defined
group with all grid cells or all surface elements.
</P>
<P>The <I>region-ID</I> is the ID of a geometric region defined by the
<A HREF = "region.html">region</A> command.  Only particles or grid cells or surface
elements in the region will have their values set.  The center point
of a grid cell or surface element is used for the region check.  If
<I>region-ID</I> is specified as NULL, then the region criterion is not
applied.
</P>
<HR>

<P>The <I>file</I> action resets the values of one or more custom attributes
by reading them from the <I>fname</I> file.  It can only be used with
<I>style grid</I> or <I>style surf</I>, not with <I>style particle</I>.
</P>
<P>The specified (M) number of <I>cname1,cname2,...,cnameM</I> arguments must
match the number of values listed on each line in the file.  A
<I>cnameI</I> with no brackets is the name of a custom vector.  For a
custom array, <I>cnameI</I> must be of the form name[N] for the Nth
column of the array.
</P>
<P>The format of the file is as follows.  Note that the number of grid
cells or surf elements specified in the file does not have to equal
the total number of grid cells or surface elements.  If the ID of a
grid cell or surface element does not appear in the file, then its
custom attribute value(s) will be unchanged.
</P>
<P>The file can start with any number of comment or blank lines.
A comment line starts with the "#" character.
</P>
<P>The first non-comment, non-blank line must be an integer count N of
the number of attribute value lines which follow in the file.  These N
lines must immediately follow the count line and contain no blank
lines.  Any remaining lines in the file are ignored.
</P>
<P>The format of each attribute value line is as follows:
</P>
<P>ID value1 value2 ... valueM
</P>
<P>ID is the integer ID of the grid cell or surface element.  Note that
for hierarchial grids, it must be the integer form of the ID, not the
string form (possibly with dashes).  M values follow, corresponding to
the <I>M</I> argument in the input script, following the <I>fname</I> argument.
</P>
<P>The following is an example of a correctly formatted file to set the
values for a per-surf custom array with 2 columns.  Only the values
for 3 surface elements are set.
</P>
<PRE># custom values for a few surface elements
# calculated for test problem XYZ 
</PRE>
<PRE>3
1 10.0 5.0
20 12.0 6.5
21 8.0 4.55 
</PRE>
<P>This file could be read with an input script command like this:
</P>
<PRE>custom surf create darray float 2 file file.surf 2 darray[1] darray[2] 
</PRE>
<HR>

<P>The <I>file/coarse</I> action resets the values of one or more custom
attributes by reading them from one or more files.  It can only be
used with <I>style grid</I>, not with <I>style surf</I> or <I>style particle</I>.
</P>
<P>IMPORTANT NOTE: The file/coarse action has NOT yet been implemented
for this command.
</P>
<P>This action is designed to allow input of custom values for a handful
of "coarse" cells.  The values for each coarse cell are assigned to
multiple smaller SPARTA grid cells.  The coarse cells could be from
another code, such as a continuum Navier-Stokes (NS) code.  This
operation allows the solution from the NS code to be be mapped to the
SPARTA grid.
</P>
<P>Creation of the file(s) used by this action is a pre-processing step,
which in the NS context could calculates which SPARTA grid cells to
assign to each coarse grid cell, based on the geometry of the two
grids.  The <A HREF = "create_particles.html">create_particles</A> command could be
used with its custom options to create particles with properties that
match the NS solution.  Using this action with the <A HREF = "fix_custom.html">fix
custom</A> command could assign per-grid custom values
based on different time snapshots from the NS code.
</P>
<P>The <I>Nfile</I> argument is the number of files to read.  If <I>Nfile</I> > 1,
then the specified <I>fname</I> must contain a a wildcard "%" character
which is replaced by the numbers from 1 to Nfile to generate each
filename.  For example, if <I>Nfile</I> = 3 and <I>fname</I> is specified as
surf.%.attribute, then files surf.1.attribute, surf.2.attribute,
surf.3.attribute, etc will be read.  Note that if the <A HREF = "fix_custom.html">fix
custom</A> command uses this action, and there are also
multiple coarse files for each of the different timesteps , then the
specified <I>fname</I> must contain both wildcard "%" and "*" characters.
</P>
<P>The specified (M) number of <I>cname1,cname2,...,cnameM</I> arguments must
match the number of values listed for each coarse cell entry in each
file.  A <I>cnameI</I> with no brackets is the name of a custom vector.
For a custom array, <I>cnameI</I> must be of the form name[N] for the Nth
column of the array.
</P>
<P>The reason to use multiple files is a single file would be extremely
large and/or to enable more parallelism by having different processors
read different files simultaneously.  Conceptually, the information being
read is the union of the information from all the individual files.
</P>
<P>As explained below, for each coarse cell entry, one of more SPARTA
grid cell IDs is specified.  The custom values for the coarse cell are
assigned to each of the SPARTA grid cells.  The union of all the
SPARTA grid cell IDs (from all the files) should have no duplicates.
But the union does not have to equal the total number of SPARTA grid
cells.  If the ID of a SPARTA grid cell does not appear in any of the
files, then its custom attribute value(s) will be unchanged.
</P>
<P>The format of each <I>text</I> file is as follows.  One of more of these
files should be written by the pre-processing code in text (ASCII)
format.
</P>
<P>It can start with any number of comment or blank lines.  A comment
line starts with the "#" character.
</P>
<P>The first non-comment, non-blank line must be an integer count Nentry
of the number of coarse cell entries which follow in this file.  The
entries must immediately follow the count line and contain no blank
lines.  Any remaining lines in the file are ignored.
</P>
<P>The format of each coarse cell entry is as follows:
</P>
<P>coarse-ID Ncells value1 value2 ... valueM
cell1-ID cell2-ID ... (10 per line until complete, last line may have fewer)
</P>
<P>On the first line, the coarse-ID is simply an index for the coarse
cell entry.  It may be convenient for indexing the coarse grid cells
from another code.  Or for indexing the entries across multiple coarse
files.  SPARTA ignores this index value.
</P>
<P>Ncells is the count of SPARTA grid cells which are mapped to this
coarse cell entry.  Conceptually, it could be the list of SPARTA grid
cells whose center points fall inside the coarse grid cell from
another code.
</P>
<P>M values follow, corresponding to the <I>M</I> argument in the input
script, following the <I>fname</I> argument.
</P>
<P>The next line(s) list the <I>Ncell</I> SPARTA grid cell IDs.  If <I>Ncell</I> >
10, list 10 per line.  The last line contains from 1 to 10 grid cell
IDs.  Note that for hierarchial grids, each grid cell ID must be the
integer form of the ID, not the string form (possibly with dashes).
</P>
<P>The following is an example of a correctly formatted file to set the
values for a per-grid custom array with 2 columns.  Only the
values for 30 SPARTA grid cells are set (6+6+18).
</P>
<PRE># custom values for a few Navier-Stokes elements
# calculated for test problem XYZ 
</PRE>
<PRE>3
1 6 10.0 5.0
  2 4 6 8 10 12
2 6 12.0 6.5
  1 3 5 7 9 11
3 18 8.0 4.55
  13 14 15 16 17 18 19 20 21 22
  23 24 25 26 27 28 29 30 
</PRE>
<P>This file could be read with an input script command like either of these:
</P>
<PRE>custom surf create darray float 2 file/coarse 1 text file.surf 2 darray[1] darray[2]
custom surf create darray float 2 file/coarse 3 text file.surf.% 2 darray[1] darray[2] 
</PRE>
<P>The latter command assumes there are 2 other files like this one, with
names file.surf.1, file.surf.2, and file.surf.3.
</P>
<P>The format of each <I>binary</I> file is as follows.  One of more of these
files should be written by the pre-processing code in binary format.
</P>
<PRE>precision of grid-cell IDs (4-byte integer)
Nentry (4-byte integer)
entry-ID for entry # 1 (4-byte integer)
Ncell (4-byte integer)
M custom values (8-byte doubles)
Ncell grid-IDs (4- or 8-byte integers)
...
entry-ID for entry # Nentry (4-byte integer)
Ncell (4-byte integer)
M custom values (8-byte doubles)
Ncell grid-IDs (4- or 8-byte integers) 
</PRE>
<P>The precision is the number 32 or 64 and depends on the precision the
SPARTA executable is using to store its grid cell IDs.  If SPARTA was
compiled with the SPARTA_BIG setting (default), then precision = 32
for 32-bit grid cell IDs.  If SPARTA was compiled with the
SPARTA_BIGBIG setting, then precision = 64 for 64-bit grid cell IDs.
</P>
<P>Nentry refers to the number of coarse cell entries in this file.
</P>
<P>The double for custom values refers to an 8-byte floating point value.
If the corresponding custom attribute in SPARTA is of type <I>int</I>, then
the floating point value read from the file will be truncated to an
integer.  E.g. 12.0 --> 12, 12.3 --> 12.
</P>
<P>The 4 lines listed above as entry-ID, Ncell, M custom values, Ncell
grid-IDs are repeated Nentry times in the binary file.
</P>
<HR>

<P><B>Restrictions:</B> none
</P>
<P><B>Related commands:</B>
</P>
<P><A HREF = "fix_custom.html">fix custom</A>, <A HREF = "mixture.html">mixture</A>,
<A HREF = "group.html">group</A>, <A HREF = "region.html">region</A>
</P>
<P><B>Default:</B> none
</P>
</HTML>
