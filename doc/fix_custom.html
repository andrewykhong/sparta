<HTML>
<CENTER><A HREF = "https://sparta.github.io">SPARTA WWW Site</A> - <A HREF = "Manual.html">SPARTA Documentation</A> - <A HREF = "Section_commands.html#comm">SPARTA Commands</A> 
</CENTER>






<HR>

<H3>fix custom command 
</H3>
<P><B>Syntax:</B>
</P>
<PRE>fix ID custom Nfreq style action args ... action args ... 
</PRE>
<UL><LI>ID is documented in <A HREF = "fix.html">fix</A> command 

<LI>custom = style name of this fix command 

<LI>Nfreq = reset custom values every this many steps 

<LI>style = <I>particle</I> or <I>grid</I> or <I>surf</I> 

<LI>action = <I>set</I> or <I>file</I> 

<PRE>  <I>set</I> args = cname v_name subset-ID region-ID
    cname = specify as name (no brackets) for custom vector with name
            or as name[N] for Nth column of custom array with name
    v_name = equal-, particle-, grid-, or surf-style variable with name
    subset-ID = mixture ID (particles) or group ID (grid cells or surf elements)
    region-ID = only apply to particle/grid/surf in region, NULL to not test
  <I>file</I> args = fname M cname1 cname2 ... cnameM
      fname = wildcard name of file with custom attributes for grid cells or surf elements
    M = # of custom values listed on each line of each file
    cname1,cname2,...,cnameM = which attribute each line's values are assigned to
      cnameI = name of a custom vector
      cnameI = name[N] for Nth column of a custom array with name
  <I>file/coarse</I> args = Nfile filestyle fname M cname1 cname2 ... cnameM
    Nfile = number of coarse files
    filestyle = <I>text</I> or <I>binary</I>
    fname = name of file with custom attributes for coarse grid cells
    M = # of custom values listed for each coarse cell entry in the file
    cname1,cname2,...,cnameM = which attribute each coarse cell's values are assigned to
      cnameI = name of a custom vector
      cnameI = name[N] for Nth column of a custom array with name 
</PRE>

</UL>
<P><B>Examples:</B>
</P>
<P>variable dvec particle (x+y)/2.0
custom particle create dvec double 0
custom surf create temp double 0 create vstream double 3
</P>
<P>fix 1 custom 1000 particle set dvec v_dvec air NULL
fix 1 custom 10000 surf file surf.temp.* 1 temp file surf.vstream.* 3 vstream[1] vstream[2] vstream[3]
fix 1 custom 10000 surf file surf.flow.* 4 temp vstream[1] vstream[2] vstream[3]
</P>
<P><B>Description:</B>
</P>
<P>Reset one or more custom attributes for particles, grid cells, or
surface elements.  This operation is performed once every <I>Nfreq</I>
timesteps.
</P>
<P>The <I>set</I> action evaluates a variable to reset the values for an
attribute.  The <I>file</I> action reads a file with lines starting with a
grid cell ID or surface element ID followed by values for one or more
per-grid or per-surf attributes.  Particle-style attributes cannot be
reset with the <I>file</I> action.
</P>
<P>Custom attributes can be vectors (single value per entity) or arrays
(mutiple values per entity).  They can also be integer or floating
point values.  See <A HREF = "Section_howto.html#howto_17">Section 6.17</A> for an
explanation of custom attributes.
</P>
<P>Each <I>style</I> setting is <I>particle</I> or <I>grid</I> or <I>surf</I> for custom
per-particle, per-grid, or per-surf attributes.
</P>
<P>The <I>action</I> setting is <I>set</I> or <I>file</I> or <I>file/coarse</I>.  The
functionality and syntax for these settings are identical to the
<A HREF = "custom.html">custom</A> command, with the exception that the filename for
the <I>file</I> and <I>file/coarse</I> actions must include a wildcard "*"
character which is replaced by the current timestep each time this fix
operates, so that different files are read.  See more discussion
below.
</P>
<P>The <I>set</I> and <I>file</I> and <I>file/coarse</I> actions reset the values of
custom attribute(s) which must already exist.  See the
<A HREF = "custom.html">custom</A> and <A HREF = "read_surf.html">read_surf</A> and
<A HREF = "read_grid.html">read_grid</A> commands for different ways to define and
initialize custom attributes.
</P>
<P>Note that the resetting of attributes by this fix takes place at the
end of timesteps determined by <I>Nfreq</I>.  If custom attributes are
output by a <A HREF = "dump.html">dump</A> command on the same timestep, that takes
place after this fix has performed the reset.  This means that if this
fix and a dump command both reset/output every 1000 steps, then a dump
file snapshot for step 3000 could include custom attributes which were
reset at the end of step 3000.  But the new attribute values will not
influence particles or grid cells or surface elements until the
following step 3001 and beyond.
</P>
<P>Also note that this command DOES NOT reset attribute values at the
beginning of any run, even if an input script contains multiple
<A HREF = "run.html">run</A> commands.  For example, if <I>Nfreq</I> = 1000 and the input
script performs a series of 10000-step runs, then no resetting of
attributes takes place (due to this command) on timestep 0, before the
first run.  Likewise, between runs, this command DOES reset attribute
values at the end of the last step (10000, 20000, etc) of each run,
but DOES NOT reset them again before the first step of the next run.
</P>
<P>IMPORTANT NOTE: If needed, resets of custom values can be performed
before the first run or between runs using the <A HREF = "custom.html">custom</A>
command.
</P>
<P>IMPORTANT NOTE: If <I>Nfreq</I> triggers the reading of a file on the last
step of the last run in the input script, then the
wildcard-substituted filename (explained below) must exist.  This is
the case, even though the new values will have no effect in the
current input script, since there are no operations on subsequent
timesteps which use them.  Note, however that if a restart file is
wrtten on the last timestep, the updated custom values will be written
to the restart file.
</P>
<HR>

<P>The <I>set</I> action resets the values of a custom attribute by evaluating
a variable.  To operate on a custom vector, <I>cname</I> is simply the name
of the vector.  To operate on a single column of a custom array,
<I>cname</I> is specified as name[N] for the Nth column of a custom array
with name.
</P>
<P>The specified <I>v_name</I> is the name of the variable which is evaluated.
It must be either an equal-style or particle-style or grid-style or
surf-style variable.  All of these define a mathematical formula which
is used to compute the value(s) of the variable.  See the
<A HREF = "variable.html">variable</A> command for details.
</P>
<P>If an equal-style variable is specified, it produces a single value
which will be assigned as the custom value to all the particles or
grid cells or surface elements (see subset-ID and region-ID discussion
below).  Otherwise a particle-style variable must be used for <I>style
particle</I>, a grid-style variable for <I>style grid</I>, or a surf-style
variable for <I>style surf</I>.  When it is evaluated it generates one
value for each particle, grid cell, or surface element, which is
assigned to the custom vector or to a column of the custom array.
</P>
<P>Note that the latter 3 variable styles can include outputs from
<A HREF = "compute.html">compute</A> or <A HREF = "fix.html">fix</A> commands.  They can also
include the current timestep (as can equal-style variables) or the
spatial position of a particle, grid cell, or surface element in their
formula.  So it is easy to calculate a value for each entity which
varies in time or spatially.
</P>
<P>The next two arguments, <I>subset-ID</I> and <I>region-ID</I>, can limit which
particles, grid cells, or surface elements are assigned a custom
value.  An individual particle, grid cell, or surface element must
meet both criteria to have its custom value set, otherwise its value
is unchanged.
</P>
<P>The <I>subset-ID</I> is the ID of a mixture for particles or the ID of a
group of grid cells or surface elements.  Only particles in the
mixture or grid cells/surface elements in the group will be assigned a
value.  See the <A HREF = "mixture.html">mixture</A> and <A HREF = "group.html">group</A> commands
for more details.  Note that "all" is a pre-defined mixture ID which
contains all particles.  Likewise "all" is the name of a pre-defined
group with all grid cells or all surface elements.
</P>
<P>The <I>region-ID</I> is the ID of a geometric region defined by the
<A HREF = "region.html">region</A> command.  Only particles or grid cells or surface
elements in the region will have their values set.  The center point
of a grid cell or surface element is used for the region check.  If
<I>region-ID</I> is specified as NULL, then the region criterion is not
applied.
</P>
<HR>

<P>The <I>file</I> action resets the values of one or more custom attributes
by reading them from the <I>fname</I> file.  It can only be used with
<I>style grid</I> or <I>style surf</I>, not with <I>style particle</I>.
</P>
<P>The specified <I>fname</I> must contain a wildcard "*" character which is
replaced by the current timestep each time this fix is invoked.  For
example, if <I>Nfreq</I> = 1000 and <I>fname</I> is specified as
surf.*.attribute, then files surf.1000.attribute, surf.2000.attribute,
surf.3000.attribute, etc will be read on timesteps 1000, 2000, 3000,
etc.
</P>
<P>The number of <I>cname1,cname2,...,cnameM</I> arguments must match the
number of values listed on each line in the file.  A <I>cnameI</I> with no
brackets is the name of a custom vector.  For a custom array, <I>cnameI</I>
must be of the form name[N] for the Nth column of the array.
</P>
<P>The format of each file is identical to the file format explained on
the <A HREF = "custom.html">custom</A> command doc page for use with its <I>file</I>
action.
</P>
<HR>

<P>The <I>file/coarse</I> action resets the values of one or more custom
attributes by reading them from the <I>fname</I> file.  It can only be used
with <I>style grid</I>, not with <I>style surf</I> or <I>style particle</I>.
</P>
<P>IMPORTANT NOTE: The <I>file/coarse</I> action has NOT yet been implemented
for this command.
</P>
<P>The specified <I>fname</I> must contain a wildcard "*" character which is
replaced by the current timestep each time this fix is invoked.  For
example, if <I>Nfreq</I> = 1000 and <I>fname</I> is specified as
surf.*.attribute, then files surf.1000.attribute, surf.2000.attribute,
surf.3000.attribute, etc will be read on timesteps 1000, 2000, 3000,
etc.
</P>
<P>The number of <I>cname1,cname2,...,cnameM</I> arguments must match the
number of values listed on each line in the file.  A <I>cnameI</I> with no
brackets is the name of a custom vector.  For a custom array, <I>cnameI</I>
must be of the form name[N] for the Nth column of the array.
</P>
<P>The format of each file is identical to the file format explained on
the <A HREF = "custom.html">custom</A> command doc page for use with its
<I>file/coarse</I> action.
</P>
<P>Note that if there are multiple coarse files for each timestep, then
the specified <I>fname</I> must contain both wildcard "*" and "%"
characters.
</P>
<HR>

<P><B>Restrictions:</B> none
</P>
<P><B>Related commands:</B>
</P>
<P><A HREF = "custom.html">custom</A>, <A HREF = "mixture.html">mixture</A>, <A HREF = "group.html">group</A>,
<A HREF = "region.html">region</A>
</P>
<P><B>Default:</B> none
</P>
</HTML>
